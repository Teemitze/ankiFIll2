<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>AnkiFill</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script>
        function AnkiCard(word, transcription, translation, examples, soundURL) {
            this.word = word;
            this.transcription = transcription;
            this.translation = translation;
            this.examples = examples;
            this.soundURL = soundURL;
        }

        function Examples(engExample, rusExample) {
            this.engExample = engExample;
            this.rusExample = rusExample;
        }


        function sendTable() {
            let cells = document.getElementsByTagName("tr");

            let ankiCards = [];

            for (let i = 1; i < cells.length; i++) {
                let word = cells[i].getElementsByTagName("td").item(1).innerText;
                let transcription = cells[i].getElementsByTagName("td").item(2).innerText;
                let translation = cells[i].getElementsByTagName("td").item(3).getElementsByTagName("input").item(0).value;
                let engExample = cells[i].getElementsByTagName("td").item(4).getElementsByTagName("option");
                let selectEngExample = findSelectExample(engExample);

                let rusExamples = cells[i].getElementsByTagName("td").item(5).getElementsByTagName("option");
                let selectRusExample = findSelectExample(rusExamples);

                let examples = new Examples(selectEngExample, selectRusExample);


                let soundURL = cells[i].getElementsByTagName("td").item(6).innerText;

                const ankiCard = new AnkiCard(word, transcription, translation, examples, soundURL);

                ankiCards.push(ankiCard);
            }

            sendRequest(ankiCards);
        }

        function findSelectExample(examples) {
            for (let i = 0; i < examples.length; i++) {
                if (examples[i].selected === true) {
                    return examples[i].innerText;
                }
            }
        }

        function sendRequest(ankiCards) {
            var xhr = new XMLHttpRequest();

            var body = JSON.stringify(ankiCards);

            xhr.open("POST", '/save', false);
            xhr.setRequestHeader('Content-Type', 'application/json');

            console.log(body)
            xhr.send(body);
        }
    </script>
    <style>
        #table_words {
            font-family: Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        #table_words td, #table_words th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #table_words tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #table_words tr:hover {
            background-color: #ddd;
        }

        #table_words th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: center;
            background-color: #4CAF50;
            color: white;
        }

        .count {
            width: 25px;
            max-width: 5px;
            text-align: center;
        }

        .word {
            width: 150px;
        }

        .transcription {
            width: 150px;
        }

        .translation {
            width: 150px;
        }

        .engExample {
            min-width: 600px;
            width: 600px;
            max-width: 600px;
        }

        .rusExample {
            min-width: 600px;
            width: 600px;
            max-width: 600px;
        }
    </style>
</head>
<body>
<table id="table_words">
    <thead>
    <tr>
        <th class="count">№</th>
        <th class="word">Word</th>
        <th class="transcription">Transcription</th>
        <th class="translation">Translation</th>
        <th class="engExample">Eng Example</th>
        <th class="rusExample">Rus Example</th>
        <th hidden>Sound</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="ankiCard, i : ${ankiCards}">
        <td th:text="${i.count}" class="count"></td>
        <td th:text="${ankiCard.word}" class="word"></td>
        <td th:text="${ankiCard.transcription}" class="transcription"></td>
        <td class="translation">
            <label>
                <input th:value="${ankiCard.translation}"/>
            </label>
        </td>
        <td class="engExample">
            <label>
                <select class="engExample">
                    <option th:each="example : ${ankiCard.examples}" th:text="${example.engExample}"
                            th:value="${example.engExample}" class="engExample">
                    </option>
                </select>
            </label>
        </td>

        <td class="rusExample">
            <label>
                <select class="rusExample">
                    <option th:each="example : ${ankiCard.examples}" th:text="${example.rusExample}"
                            th:value="${example.rusExample}" class="rusExample">
                    </option>
                </select>
            </label>
        </td>
        <td th:text="${ankiCard.soundURL}" hidden></td>
    </tr>
    </tbody>
</table>
<br>

<form action="/saveFile" method="get">
    <input value="Нажми меня" onclick="sendTable()" type="submit">
</form>
</body>
</html>